# Исправления для деплоя на Render/GitHub Pages

## Проблемы, которые были исправлены

### 1. ✅ Пути в собранных файлах
**Проблема:** Абсолютные пути (`/assets/...`) не работали на некоторых хостингах.

**Решение:** 
- Настроен `base: './'` в `vite.config.js` для production
- Все пути теперь относительные (`./assets/...`)
- Файлы правильно организованы в `assets/js/` и `assets/css/`

### 2. ✅ MIME типы для JavaScript
**Проблема:** Некоторые серверы неправильно определяли MIME тип для `.js` файлов.

**Решение:**
- Настроены правильные пути в `rollupOptions` в `vite.config.js`
- Добавлен `.htaccess` с правильными MIME типами
- JavaScript файлы теперь имеют правильный тип `application/javascript`

### 3. ✅ SPA роутинг
**Проблема:** При прямом переходе на `/login` или `/guild/123` сервер возвращал 404.

**Решение:**
- Создан `_redirects` для Netlify
- Создан `.htaccess` для Apache
- Все запросы теперь перенаправляются на `index.html` для обработки React Router

### 4. ✅ API URL конфигурация
**Проблема:** API использовал жестко заданный путь `/api`, который не работал на разных доменах.

**Решение:**
- Обновлен `api.js` для использования переменной окружения `VITE_API_URL`
- В production можно задать полный URL API через переменную окружения

### 5. ✅ Навигация
**Проблема:** В `Login.jsx` была навигация на несуществующий роут `/dashboard`.

**Решение:**
- Исправлена навигация на `/` (главная страница с выбором серверов)

### 6. ✅ Отсутствующие ресурсы
**Проблема:** Ссылка на несуществующий `/default-avatar.png` могла вызывать 404.

**Решение:**
- Заменена на fallback с инициалом пользователя в цветном круге

## Структура собранного проекта

```
dashboard/dist/
├── index.html          # Главный HTML файл с правильными путями
├── favicon.svg         # Иконка сайта
├── _redirects          # Для Netlify SPA роутинга
├── .htaccess          # Для Apache SPA роутинга
└── assets/
    ├── js/
    │   └── index-[hash].js    # JavaScript с правильными MIME типами
    └── css/
        └── index-[hash].css   # CSS файлы
```

## Настройка переменных окружения

### Для Frontend (Render Static Site)

**Переменные окружения:**
- `VITE_API_URL` - URL вашего API сервиса (например, `https://amaribot-api.onrender.com`)
- `VITE_DISCORD_CLIENT_ID` - Discord Client ID для OAuth

**Настройки в Render:**
- **Build Command:** `cd dashboard && npm install && npm run build`
- **Publish Directory:** `dashboard/dist`

### Для Backend (Render Web Service)

**Переменные окружения:**
- `PORT` - порт (устанавливается автоматически Render)
- `MONGODB_URI` - URI подключения к MongoDB
- `CORS_ORIGIN` - разрешённые источники (например, `https://amaribot-dashboard.onrender.com`)
- `JWT_SECRET` - секретный ключ для JWT
- `NODE_ENV` - `production`

**Настройки в Render:**
- **Build Command:** `cd api && npm install`
- **Start Command:** `cd api && npm start`

## Проверка после деплоя

1. **Проверьте главную страницу:**
   - Откройте URL вашего фронтенда
   - Должна загрузиться страница логина (не белый экран)

2. **Проверьте консоль браузера:**
   - Откройте DevTools (F12)
   - Проверьте вкладку Console на наличие ошибок
   - Проверьте вкладку Network - все файлы должны загружаться с кодом 200

3. **Проверьте пути:**
   - Все `.js` файлы должны иметь MIME тип `application/javascript`
   - Все `.css` файлы должны иметь MIME тип `text/css`

4. **Проверьте SPA роутинг:**
   - Перейдите напрямую на `/login`
   - Должна загрузиться страница логина (не 404)

5. **Проверьте API:**
   - Убедитесь, что `VITE_API_URL` правильно настроен
   - Проверьте, что CORS настроен правильно на бэкенде

## Частые проблемы и решения

### Белый экран
- ✅ Проверьте консоль браузера на ошибки
- ✅ Убедитесь, что все пути относительные (`./assets/...`)
- ✅ Проверьте, что `index.html` ссылается на правильные файлы

### 404 для JavaScript файлов
- ✅ Убедитесь, что MIME типы правильные
- ✅ Проверьте, что пути относительные, а не абсолютные
- ✅ Убедитесь, что файлы действительно существуют в `dist/assets/`

### Ошибки CORS
- ✅ Настройте `CORS_ORIGIN` на бэкенде
- ✅ Убедитесь, что `VITE_API_URL` указывает на правильный домен

### SPA роутинг не работает
- ✅ Убедитесь, что `_redirects` или `.htaccess` скопированы в `dist/`
- ✅ Для Render Static Site может потребоваться дополнительная настройка

## Дополнительные файлы

Все необходимые файлы для деплоя уже созданы:
- ✅ `dashboard/public/_redirects` - для Netlify
- ✅ `dashboard/public/.htaccess` - для Apache
- ✅ Правильная конфигурация в `vite.config.js`
- ✅ Обновленные пути в `api.js` и `Login.jsx`

