# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è Production –¥–µ–ø–ª–æ—è

## üî¥ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚ùå Nginx proxy_pass –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `deploy.sh` —Å—Ç—Ä–æ–∫–∞ 46 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ `proxy_pass http://localhost:$API_PORT/;` - —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ —É–±–∏—Ä–∞–ª `/api` –∏–∑ –ø—É—Ç–∏, –ø–æ—ç—Ç–æ–º—É –∑–∞–ø—Ä–æ—Å—ã —à–ª–∏ –Ω–∞ `/` –≤–º–µ—Å—Ç–æ `/api/...`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `proxy_pass http://localhost:$API_PORT/api;` –±–µ–∑ —Å–ª—ç—à–∞ –≤ –∫–æ–Ω—Ü–µ

### 2. ‚ùå CORS –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–ª –∑–∞–ø—Ä–æ—Å—ã —Å production –¥–æ–º–µ–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** CORS –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ `http://localhost:3000`, –Ω–æ production —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ `http://localhost:8080`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö origins –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è development —Ä–µ–∂–∏–º–∞

### 3. ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è –ø—Ä–æ–∫—Å–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ `X-Real-IP`, `X-Forwarded-For`, `X-Forwarded-Proto` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–∫—Å–∏

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ .env —Ñ–∞–π–ª–æ–≤

### API (.env)
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `api/.env` —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```env
# –í–∞–∂–Ω–æ –¥–ª—è production!
DISCORD_REDIRECT_URI=http://localhost:8080/login
CORS_ORIGIN=http://localhost:8080,http://localhost:3000

# –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
DISCORD_CLIENT_ID=your_client_id
DISCORD_CLIENT_SECRET=your_client_secret
DISCORD_BOT_TOKEN=your_bot_token
JWT_SECRET=your_jwt_secret
MONGODB_URI=mongodb://localhost:27017/discord-bot
BOT_API_TOKEN=your_secure_token
PORT=5001
```

### Dashboard (.env)
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `dashboard/.env`:

```env
VITE_DISCORD_CLIENT_ID=your_client_id
# –î–ª—è production –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π URL
VITE_API_URL=/api
```

## üîß –®–∞–≥–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ–ø–ª–æ—è

### 1. –û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª—ã

```bash
# API .env
cd api
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
# DISCORD_REDIRECT_URI=http://localhost:8080/login
# CORS_ORIGIN=http://localhost:8080,http://localhost:3000
```

### 2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

```bash
cd dashboard
npm run build
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π deploy.sh

```bash
cd ..
./deploy.sh
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –Ω–∞–ø—Ä—è–º—É—é:**
   ```bash
   curl http://localhost:5001/api/health
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ Nginx:**
   ```bash
   curl http://localhost:8080/api/health
   ```

3. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   - http://localhost:8080
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 404 –æ—à–∏–±–æ–∫
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Discord

## üêõ Troubleshooting

### –ë–µ–ª–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

**–ü—Ä–∏—á–∏–Ω–∞:** React Router –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –º–∞—Ä—à—Ä—É—Ç—ã –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ base path

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `vite.config.js` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `base: './'` (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

### 404 –æ—à–∏–±–∫–∏ –Ω–∞ /api/...

**–ü—Ä–∏—á–∏–Ω–∞:** Nginx –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx: `/opt/homebrew/etc/nginx/servers/amaribot.conf`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `proxy_pass` —É–∫–∞–∑–∞–Ω –∫–∞–∫ `http://localhost:5001/api` (–±–µ–∑ —Å–ª—ç—à–∞ –≤ –∫–æ–Ω—Ü–µ)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx: `brew services restart nginx`

### CORS –æ—à–∏–±–∫–∏

**–ü—Ä–∏—á–∏–Ω–∞:** API –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å production –¥–æ–º–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `CORS_ORIGIN` –≤ `api/.env` - –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å `http://localhost:8080`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API: `pm2 restart amaribot-api`

### Discord OAuth –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `DISCORD_REDIRECT_URI`

**–†–µ—à–µ–Ω–∏–µ:**
1. –í `api/.env` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `DISCORD_REDIRECT_URI=http://localhost:8080/login`
2. –í Discord Application (https://discord.com/developers/applications) –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∂–µ URL –≤ OAuth2 Redirect URIs
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] `api/.env` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `DISCORD_REDIRECT_URI=http://localhost:8080/login`
- [ ] `api/.env` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `CORS_ORIGIN=http://localhost:8080,http://localhost:3000`
- [ ] `dashboard/.env` —Å–æ–¥–µ—Ä–∂–∏—Ç `VITE_DISCORD_CLIENT_ID`
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω (`npm run build` –≤ –ø–∞–ø–∫–µ dashboard)
- [ ] Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–∑–∞–ø—É—â–µ–Ω `./deploy.sh`)
- [ ] API –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ PM2 (`pm2 list` –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å `amaribot-api`)
- [ ] Nginx –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω (`brew services restart nginx`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω `/api/health` —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä: http://localhost:8080/api/health

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–ª—è production —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `example.com`):

1. **–û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª—ã:**
   ```env
   # API
   DISCORD_REDIRECT_URI=https://example.com/login
   CORS_ORIGIN=https://example.com
   
   # Dashboard
   VITE_API_URL=https://example.com/api
   ```

2. **–û–±–Ω–æ–≤–∏—Ç–µ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   - –î–æ–±–∞–≤—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
   - –ò–∑–º–µ–Ω–∏—Ç–µ `server_name` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç —Å HTTP –Ω–∞ HTTPS

3. **–û–±–Ω–æ–≤–∏—Ç–µ Discord Application:**
   - –î–æ–±–∞–≤—å—Ç–µ `https://example.com/login` –≤ Redirect URIs

